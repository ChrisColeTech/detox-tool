#!/usr/bin/env node

/**
 * Generate Shared Forms Components Script
 * Creates script specifically for shared/forms directory from task-writer
 */

const fs = require('fs').promises;
const ScaffoldGenerator = require('./ScaffoldGenerator.cjs');

class SharedFormsGenerator {
  constructor() {
    this.scaffoldGenerator = new ScaffoldGenerator();
  }

  async generateSharedFormsScript() {
    console.log('ğŸ”§ Generating Shared Forms Components Script');
    console.log('============================================\n');

    try {
      console.log('ğŸ“¦ Generating shared forms script...');

      const result = await this.scaffoldGenerator.generateScaffold('/mnt/c/Projects/task-writer/frontend/app/src/components/shared/forms', {
        targetOS: 'cross-platform',
        includeContent: true,
        scriptName: 'create-detox-shared-forms',
        outputFormat: 'bash',
        supportedFileTypes: ['.tsx', '.ts', '.jsx', '.js'],
        excludeNodeModules: true,
        createDirectoriesOnly: false
      });

      let content = result.scaffolds[0].content;
      
      // Fix file paths to use the correct target directory
      content = content.replace(/cat > "([^"]+)"/g, 'cat > "src/components/shared/forms/$1"');
      
      // Create the script with proper header
      const script = `#!/bin/bash

#============================================================================
# Detox Tool Shared Forms Generator Script
# Category: shared-forms
# Description: Shared form components (FormField, SettingsSection, etc.)
# Generated by: Task-Writer ScaffoldGenerator
#============================================================================

echo "ğŸš€ Creating shared forms components for detox-tool..."
echo "ğŸ“ Target: ./src/"

# Create target directory structure
mkdir -p src/components/shared/forms

${content}

echo "âœ… shared forms components created successfully!"
`;

      const scriptPath = `/mnt/c/projects/detox-tool/frontend/docs/create-detox-shared-forms.sh`;
      await fs.writeFile(scriptPath, script);
      
      // Make executable
      const { exec } = require('child_process');
      exec(`chmod +x "${scriptPath}"`);

      console.log('   âœ… Generated create-detox-shared-forms.sh');
      console.log('\nâœ… Shared forms script generated!');
      console.log('ğŸ“¦ Run: bash create-detox-shared-forms.sh');

    } catch (error) {
      console.log(`   âŒ Failed to generate shared forms: ${error.message}`);
    }
  }
}

// Run if called directly
async function main() {
  const generator = new SharedFormsGenerator();
  await generator.generateSharedFormsScript();
}

if (require.main === module) {
  main().catch(console.error);
}

module.exports = SharedFormsGenerator;