#!/usr/bin/env node

/**
 * Generate Settings Pages Script
 * Creates script specifically for settings pages from task-writer
 */

const fs = require('fs').promises;
const ScaffoldGenerator = require('./ScaffoldGenerator.cjs');

class SettingsPagesGenerator {
  constructor() {
    this.scaffoldGenerator = new ScaffoldGenerator();
  }

  async generateSettingsPagesScript() {
    console.log('ğŸ”§ Generating Settings Pages Script');
    console.log('===================================\n');

    try {
      console.log('ğŸ“¦ Generating settings pages script...');

      const result = await this.scaffoldGenerator.generateScaffold('/mnt/c/Projects/task-writer/frontend/app/src/pages/settings', {
        targetOS: 'cross-platform',
        includeContent: true,
        scriptName: 'create-detox-settings-pages',
        outputFormat: 'bash',
        supportedFileTypes: ['.tsx', '.ts', '.jsx', '.js'],
        excludeNodeModules: true,
        createDirectoriesOnly: false
      });

      let content = result.scaffolds[0].content;
      
      // Fix file paths to use the correct target directory
      content = content.replace(/cat > "([^"]+)"/g, 'cat > "src/pages/settings/$1"');
      
      // Create the script with proper header
      const script = `#!/bin/bash

#============================================================================
# Detox Tool Settings Pages Generator Script
# Category: settings-pages
# Description: Settings pages (SettingsPage, SettingsPanel)
# Generated by: Task-Writer ScaffoldGenerator
#============================================================================

echo "ğŸš€ Creating settings pages for detox-tool..."
echo "ğŸ“ Target: ./src/"

# Create target directory structure
mkdir -p src/pages/settings

${content}

echo "âœ… settings pages created successfully!"
`;

      const scriptPath = `/mnt/c/projects/detox-tool/frontend/docs/create-detox-settings-pages.sh`;
      await fs.writeFile(scriptPath, script);
      
      // Make executable
      const { exec } = require('child_process');
      exec(`chmod +x "${scriptPath}"`);

      console.log('   âœ… Generated create-detox-settings-pages.sh');
      console.log('\nâœ… Settings pages script generated!');
      console.log('ğŸ“¦ Run: bash create-detox-settings-pages.sh');

    } catch (error) {
      console.log(`   âŒ Failed to generate settings pages: ${error.message}`);
    }
  }
}

// Run if called directly
async function main() {
  const generator = new SettingsPagesGenerator();
  await generator.generateSettingsPagesScript();
}

if (require.main === module) {
  main().catch(console.error);
}

module.exports = SettingsPagesGenerator;