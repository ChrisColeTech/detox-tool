#!/usr/bin/env node

/**
 * Generate Missing Filetree Component Scripts
 * Creates scripts for the missing filetree components that exist in task-writer
 */

const fs = require('fs').promises;
const ScaffoldGenerator = require('./ScaffoldGenerator.cjs');

class MissingFiletreeGenerator {
  constructor() {
    this.scaffoldGenerator = new ScaffoldGenerator();
  }

  async generateFiletreeScript() {
    console.log('ğŸ”§ Generating Missing Filetree Components');
    console.log('=========================================\n');

    try {
      console.log('ğŸ“¦ Generating filetree components script...');

      const result = await this.scaffoldGenerator.generateScaffold('/mnt/c/Projects/task-writer/frontend/app/src/components/features/filetree', {
        targetOS: 'cross-platform',
        includeContent: true,
        scriptName: 'create-detox-filetree-components',
        outputFormat: 'bash',
        supportedFileTypes: ['.tsx', '.ts', '.jsx', '.js'],
        excludeNodeModules: true,
        createDirectoriesOnly: false
      });

      let content = result.scaffolds[0].content;
      
      // Fix file paths to use the correct target directory
      content = content.replace(/cat > "([^"]+)"/g, 'cat > "src/components/features/filetree/$1"');
      
      // Create the script with proper header
      const script = `#!/bin/bash

#============================================================================
# Detox Tool Component Generator Script
# Category: filetree-components
# Description: Missing filetree components (TreeNodeComponent, FileTreeEmptyState)
# Generated by: Task-Writer ScaffoldGenerator
#============================================================================

echo "ğŸš€ Creating filetree components for detox-tool..."
echo "ğŸ“ Target: ./src/"

# Create target directory structure
mkdir -p src/components/features/filetree

${content}

echo "âœ… filetree components created successfully!"
`;

      const scriptPath = `/mnt/c/projects/detox-tool/frontend/docs/create-detox-filetree-components.sh`;
      await fs.writeFile(scriptPath, script);
      
      // Make executable
      const { exec } = require('child_process');
      exec(`chmod +x "${scriptPath}"`);

      console.log('   âœ… Generated create-detox-filetree-components.sh');
      console.log('\nâœ… Missing filetree components script generated!');
      console.log('ğŸ“¦ Run: bash create-detox-filetree-components.sh');

    } catch (error) {
      console.log(`   âŒ Failed to generate filetree components: ${error.message}`);
    }
  }
}

// Run if called directly
async function main() {
  const generator = new MissingFiletreeGenerator();
  await generator.generateFiletreeScript();
}

if (require.main === module) {
  main().catch(console.error);
}

module.exports = MissingFiletreeGenerator;